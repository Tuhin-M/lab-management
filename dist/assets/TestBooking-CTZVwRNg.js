import{ae as ee,bq as se,bc as ae,r as b,a7 as e,aA as re,a8 as te,aM as le,aO as R,a9 as oe,ah as D,br as ie,bo as V,aH as L}from"./index-DGQnzEId.js";import{L as ne}from"./label-CfCTkVuX.js";import{B as de}from"./badge-mzHaQXoz.js";import{C as ce,f as w}from"./calendar-Ck8xVGdk.js";import{D as me,a as xe,b as he,c as pe,d as ge,f as be}from"./dialog-BTwoG3e5.js";import{F as ue,a as m,b as o,c as i,d as n,e as x}from"./form-D0N6cZYL.js";import{R as T,a as C}from"./radio-group-L3fHJYWU.js";import{u as je,t as fe,z as d}from"./zod-CevI-mEX.js";import{C as A,b as G,c as U,a as B,e as Ne}from"./card-B6dWGu8z.js";import{I as j}from"./input-CIeWkrV3.js";import{A as ye}from"./arrow-left-BfpFyjlb.js";import{B as ve}from"./building-2-N_Mgsd4Z.js";import{C as we}from"./credit-card-DdlhQ_Hp.js";import{C as q}from"./circle-check-big-Ct3_jBnM.js";import{S as Ce}from"./shield-check-CT_sfPRW.js";import{S as Pe}from"./star-CBVwIYeS.js";import"./index-CipDl9u1.js";const ke={id:"lab-default",name:"HealthPlus Diagnostics",address:"123 Healthcare Avenue, Koramangala, Bangalore",rating:4.7,reviews:243,homeCollectionCharges:100},Me={id:"test-default",name:"Complete Blood Count (CBC)",description:"A comprehensive blood test to evaluate overall health.",category:"Blood",price:599},Se=d.object({patientName:d.string().min(2,{message:"Name must be at least 2 characters"}),patientAge:d.string().refine(u=>!isNaN(Number(u))&&Number(u)>0&&Number(u)<120,{message:"Age must be a number between 1 and 120"}),patientGender:d.enum(["male","female","other"],{required_error:"Please select a gender"}),patientPhone:d.string().min(10,{message:"Phone number must be at least 10 digits"}),patientEmail:d.string().email({message:"Invalid email address"}).optional().or(d.literal("")),collectionType:d.enum(["home","lab"],{required_error:"Please select a collection type"}),address:d.string().optional(),testDate:d.date({required_error:"Please select a date"}),timeSlot:d.string({required_error:"Please select a time slot"})}),$e=()=>{var O,H,E;const u=ee(),P=se(),{id:f}=ae(),h=(O=P.state)==null?void 0:O.lab,N=(H=P.state)==null?void 0:H.tests,z=(E=P.state)==null?void 0:E.price,F=s=>{if(!s)return ke;let a=s.address;if(typeof a=="object"||!a){const c=[s.address_street,s.address_city,s.address_state,s.address_pincode].filter(Boolean);a=c.length>0?c.join(", "):"Lab Location"}return{id:s.id||"lab-default",name:s.name||"Lab",address:a,rating:s.rating||s.avgRating,reviews:typeof s.reviews=="number"?s.reviews:20,image:s.image||s.imageUrl,imageUrl:s.imageUrl||s.image,homeCollectionCharges:s.homeCollectionCharges||100}},[r,$]=b.useState(()=>F(h)),[p,J]=b.useState(N&&N.length>0?N:[Me]),[Y,_]=b.useState(!h||!N);b.useEffect(()=>{(async()=>{if(!h&&f)try{const c=(await V.getAllLabs()).find(g=>g.tests.some(S=>S.id===f));if(c){$(F(c));const g=c.tests.find(S=>S.id===f);g&&J([g])}}catch(a){console.error("Error fetching missing booking data:",a)}finally{_(!1)}else _(!1)})()},[f,h]);const[K,y]=b.useState(!1),[t,W]=b.useState(null),k=r.homeCollectionCharges||100,Q=["07:00 AM - 08:00 AM","08:00 AM - 09:00 AM","09:00 AM - 10:00 AM","10:00 AM - 11:00 AM","11:00 AM - 12:00 PM","12:00 PM - 01:00 PM","01:00 PM - 02:00 PM","02:00 PM - 03:00 PM","03:00 PM - 04:00 PM","04:00 PM - 05:00 PM","05:00 PM - 06:00 PM","06:00 PM - 07:00 PM"],l=je({resolver:fe(Se),defaultValues:{patientName:"",patientAge:"",patientGender:"male",patientPhone:"",patientEmail:"",collectionType:"lab",address:""}}),M=l.watch("collectionType"),I=z||p.reduce((s,a)=>s+(a.price||0),0),v=I+(M==="home"?k:0),X=s=>{W(s),y(!0)},Z=async()=>{if(t)try{await V.bookTest({labId:r.id,tests:p,date:w(t.testDate,"yyyy-MM-dd"),timeSlot:t.timeSlot,totalAmount:v,patientName:t.patientName,patientPhone:t.patientPhone,homeCollection:t.collectionType==="home"});const s={id:`LAB-${Date.now()}`,type:"lab",status:"processing",lab:r.name,tests:p.map(g=>g.name),date:w(t.testDate,"yyyy-MM-dd"),time:t.timeSlot.split(" - ")[0],paymentStatus:"pending",amount:v,address:t.collectionType==="home"?t.address||r.address||"Home Collection":r.address||"Lab Visit",trackingSteps:[{id:1,label:"Order Placed",completed:!0,date:w(new Date,"yyyy-MM-dd")},{id:2,label:"Sample Collection",completed:!1},{id:3,label:"Testing in Progress",completed:!1},{id:4,label:"Results Processing",completed:!1},{id:5,label:"Report Ready",completed:!1}],patientName:t.patientName,patientPhone:t.patientPhone},a=localStorage.getItem("ekitsa_lab_orders"),c=a?JSON.parse(a):[];c.unshift(s),localStorage.setItem("ekitsa_lab_orders",JSON.stringify(c)),y(!1),L.success("Test booking confirmed! You will receive a confirmation on your phone."),u("/orders")}catch(s){console.error("Booking error:",s),L.error("Failed to book test. Please try again.")}};return e.jsxs("div",{className:"min-h-screen bg-slate-50/50 flex flex-col pt-16 relative selection:bg-primary/20",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none z-0",children:[e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"}),e.jsx("div",{className:"absolute top-0 right-0 w-[600px] h-[600px] bg-primary/5 rounded-full blur-[120px] opacity-60"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-[600px] h-[600px] bg-blue-500/5 rounded-full blur-[120px] opacity-60"})]}),Y&&e.jsx(re,{}),e.jsx("main",{className:"flex-grow container mx-auto py-8 px-4 relative z-10",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs(te,{to:h?`/lab/${r.id}`:"/lab-tests",className:"inline-flex items-center text-muted-foreground hover:text-primary mb-6 transition-colors group",children:[e.jsx(ye,{className:"h-4 w-4 mr-2 group-hover:-translate-x-1 transition-transform"}),"Back to ",h?"Lab Details":"Lab Tests"]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2",children:"Book Your Test"}),e.jsxs("p",{className:"text-muted-foreground",children:["Complete the form below to schedule your appointment at ",r.name]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(A,{className:"bg-white/80 backdrop-blur-md border border-white/20 shadow-xl overflow-hidden rounded-2xl",children:[e.jsx(G,{className:"bg-gradient-to-r from-primary/10 to-transparent border-b border-primary/5 pb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white p-2 rounded-xl shadow-sm",children:e.jsx(le,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(U,{children:"Patient Details"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Who is this booking for?"})]})]})}),e.jsx(B,{className:"pt-8",children:e.jsx(ue,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(X),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(m,{control:l.control,name:"patientName",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Full Name"}),e.jsx(n,{children:e.jsx(j,{placeholder:"John Doe",...s,className:"bg-white/50 backdrop-blur-sm border-gray-200 focus:border-primary/50 focus:ring-primary/20 h-11"})}),e.jsx(x,{})]})}),e.jsx(m,{control:l.control,name:"patientAge",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Age"}),e.jsx(n,{children:e.jsx(j,{placeholder:"35",...s,className:"bg-white/50 backdrop-blur-sm border-gray-200 focus:border-primary/50 focus:ring-primary/20 h-11"})}),e.jsx(x,{})]})})]}),e.jsx(m,{control:l.control,name:"patientGender",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Gender"}),e.jsx(n,{children:e.jsx(T,{onValueChange:s.onChange,defaultValue:s.value,className:"flex space-x-6",children:["male","female","other"].map(a=>e.jsxs(o,{className:"flex items-center space-x-2 space-y-0",children:[e.jsx(n,{children:e.jsx(C,{value:a})}),e.jsx(i,{className:"font-medium cursor-pointer capitalize",children:a})]},a))})}),e.jsx(x,{})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(m,{control:l.control,name:"patientPhone",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Phone Number"}),e.jsx(n,{children:e.jsx(j,{placeholder:"9876543210",...s,className:"bg-white/50 backdrop-blur-sm border-gray-200 focus:border-primary/50 focus:ring-primary/20 h-11"})}),e.jsx(x,{})]})}),e.jsx(m,{control:l.control,name:"patientEmail",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Email (Optional)"}),e.jsx(n,{children:e.jsx(j,{type:"email",placeholder:"you@example.com",...s,className:"bg-white/50 backdrop-blur-sm border-gray-200 focus:border-primary/50 focus:ring-primary/20 h-11"})}),e.jsx(x,{})]})})]})]}),e.jsxs("div",{className:"space-y-6 pt-6 border-t border-dashed",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-primary"}),"Collection Preference"]}),e.jsx(m,{control:l.control,name:"collectionType",render:({field:s})=>e.jsxs(o,{children:[e.jsx(n,{children:e.jsxs(T,{onValueChange:s.onChange,defaultValue:s.value,className:"grid grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsx(n,{children:e.jsx(C,{value:"lab",className:"sr-only peer"})}),e.jsxs(i,{className:"flex flex-col items-center justify-between rounded-xl border-2 border-muted bg-white p-4 hover:bg-slate-50 hover:border-primary/50 peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5 text-center cursor-pointer transition-all shadow-sm",children:[e.jsx(ve,{className:"mb-3 h-8 w-8 text-gray-400 peer-data-[state=checked]:text-primary"}),e.jsx("span",{className:"font-bold text-lg",children:"Visit Lab"}),e.jsx("span",{className:"text-xs text-muted-foreground mt-1",children:"Visit the lab location for sample collection"})]})]}),e.jsxs(o,{children:[e.jsx(n,{children:e.jsx(C,{value:"home",className:"sr-only peer"})}),e.jsxs(i,{className:"flex flex-col items-center justify-between rounded-xl border-2 border-muted bg-white p-4 hover:bg-slate-50 hover:border-primary/50 peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5 text-center cursor-pointer transition-all shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-[10px] uppercase font-bold px-2 py-0.5 rounded-full",children:"Recommended"}),e.jsx(oe,{className:"mb-3 h-8 w-8 text-gray-400 peer-data-[state=checked]:text-primary"}),e.jsx("span",{className:"font-bold text-lg",children:"Home Collection"}),e.jsxs("span",{className:"text-xs text-muted-foreground mt-1",children:["Get samples collected at your home (+₹",k,")"]})]})]})]})}),e.jsx(x,{})]})})]}),M==="home"&&e.jsx(m,{control:l.control,name:"address",render:({field:s})=>e.jsxs(o,{className:"animate-in fade-in slide-in-from-top-4 duration-300",children:[e.jsx(i,{children:"Home Address"}),e.jsx(n,{children:e.jsx(j,{placeholder:"Enter your complete address",...s,className:"bg-white/50 backdrop-blur-sm border-gray-200 focus:border-primary/50 focus:ring-primary/20 h-11"})}),e.jsx(x,{})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 pt-4",children:[e.jsx("div",{children:e.jsx(m,{control:l.control,name:"testDate",render:({field:s})=>e.jsxs(o,{className:"flex flex-col",children:[e.jsx(i,{className:"mb-2",children:"Preferred Date"}),e.jsx(n,{children:e.jsx("div",{className:"border border-gray-200 rounded-xl bg-white p-2 shadow-sm",children:e.jsx(ce,{mode:"single",selected:s.value,onSelect:s.onChange,disabled:a=>a<new Date||a>new Date(new Date().setDate(new Date().getDate()+30)),initialFocus:!0,className:"rounded-lg"})})}),e.jsx(x,{})]})})}),e.jsx("div",{children:e.jsx(m,{control:l.control,name:"timeSlot",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{className:"mb-2 block",children:"Preferred Time"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-[300px] overflow-y-auto pr-1",children:Q.map(a=>e.jsxs("div",{className:"relative",children:[e.jsx(T,{value:s.value,onValueChange:s.onChange,className:"hidden",children:e.jsx(C,{value:a,id:`time-${a}`})}),e.jsx(ne,{htmlFor:`time-${a}`,className:`flex items-center justify-center text-center rounded-lg border-2 p-3 cursor-pointer text-xs w-full transition-all hover:bg-primary/5 ${s.value===a?"border-primary bg-primary/5 text-primary font-bold":"border-gray-100 bg-white"}`,onClick:()=>s.onChange(a),children:a})]},a))}),e.jsx(x,{})]})})})]}),e.jsx("div",{className:"pt-6 border-t border-dashed",children:e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(we,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-800",children:"Pay on Sample Collection"}),e.jsx("p",{className:"text-sm text-green-700",children:"Payment will be collected at the time of sample collection (Cash/UPI)"})]})]})})})]}),e.jsx(D,{type:"submit",className:"w-full h-12 text-lg font-bold rounded-xl shadow-lg shadow-primary/20 hover:scale-[1.02] transition-transform bg-gradient-to-r from-primary to-cyan-500 hover:from-primary/90 hover:to-cyan-600",children:"Confirm Booking"})]})})})]})}),e.jsxs("div",{className:"md:sticky md:top-24 h-fit space-y-6",children:[e.jsxs(A,{className:"bg-primary/5 border-primary/20 shadow-lg overflow-hidden rounded-2xl",children:[e.jsx(G,{className:"bg-primary/10 border-b border-primary/10 pb-4",children:e.jsxs(U,{className:"text-primary flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Order Summary"]})}),e.jsxs(B,{className:"pt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wider mb-3",children:["Selected Tests (",p.length,")"]}),e.jsx("div",{className:"space-y-3",children:p.map((s,a)=>e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-primary/10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-sm",children:s.name}),e.jsxs("span",{className:"font-bold text-primary text-sm",children:["₹",s.price]})]}),s.category&&e.jsx(de,{variant:"outline",className:"text-[10px] bg-green-50 text-green-700 border-green-200 mt-1",children:s.category})]},s.id||a))})]}),e.jsxs("div",{className:"space-y-3 pt-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Test Price"}),e.jsxs("span",{children:["₹",I]})]}),M==="home"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Home Collection"}),e.jsxs("span",{children:["₹",k]})]}),e.jsx("div",{className:"border-t border-dashed pt-3 mt-2",children:e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("span",{className:"font-bold text-lg",children:"Total"}),e.jsxs("span",{className:"font-black text-2xl text-primary",children:["₹",v]})]})})]})]}),e.jsx(Ne,{className:"bg-primary/5 border-t border-primary/10 p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Ce,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Pay at Sample Collection"})]})})]}),e.jsx(A,{className:"bg-white/80 backdrop-blur-md border border-white/20 shadow-sm rounded-2xl",children:e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gray-100 overflow-hidden flex-shrink-0",children:e.jsx("img",{src:r.image||r.imageUrl||"https://images.unsplash.com/photo-1581595219315-a187dd40c322?auto=format&fit=crop&w=100&q=80",alt:r.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-sm",children:r.name}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground mt-1",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:r.address})]}),r.rating&&e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsxs("span",{className:"bg-yellow-100 text-yellow-700 text-[10px] font-bold px-1.5 py-0.5 rounded flex items-center",children:[e.jsx(Pe,{className:"h-3 w-3 mr-0.5",fill:"currentColor"}),r.rating]}),r.reviews&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["(",r.reviews," reviews)"]})]})]})]})})})]})]})]})}),t&&e.jsx(me,{open:K,onOpenChange:y,children:e.jsxs(xe,{className:"sm:max-w-md rounded-2xl overflow-hidden border-0 shadow-2xl",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-primary to-cyan-500"}),e.jsxs(he,{className:"pt-6 px-6",children:[e.jsx("div",{className:"mx-auto bg-green-100 h-12 w-12 rounded-full flex items-center justify-center mb-4",children:e.jsx(q,{className:"h-6 w-6 text-green-600"})}),e.jsx(pe,{className:"text-center text-xl",children:"Confirm Booking"}),e.jsx(ge,{className:"text-center",children:"Please review your appointment details"})]}),e.jsxs("div",{className:"px-6 py-2 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Patient"}),e.jsx("span",{className:"font-semibold",children:t.patientName})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date & Time"}),e.jsxs("span",{className:"font-semibold",children:[w(t.testDate,"MMM d")," at ",t.timeSlot.split("-")[0]]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Lab"}),e.jsx("span",{className:"font-semibold truncate max-w-[150px]",children:r.name})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tests"}),e.jsx("span",{className:"font-semibold text-right max-w-[150px] line-clamp-2",children:p.map(s=>s.name).join(", ")})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between items-center",children:[e.jsx("span",{className:"font-bold",children:"Total Amount"}),e.jsxs("span",{className:"font-bold text-lg text-primary",children:["₹",v]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs text-muted-foreground bg-green-50 p-3 rounded-lg text-green-700",children:[e.jsx(ie,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),e.jsx("p",{children:"Payment will be collected at the time of sample collection. Please keep cash or UPI ready."})]})]}),e.jsxs(be,{className:"px-6 pb-6 pt-2 gap-2 sm:gap-0",children:[e.jsx(D,{variant:"outline",onClick:()=>y(!1),className:"rounded-xl h-11 border-gray-200",children:"Back"}),e.jsx(D,{onClick:Z,className:"rounded-xl h-11 bg-primary hover:bg-primary/90",children:"Confirm Booking"})]})]})})]})};export{$e as default};
